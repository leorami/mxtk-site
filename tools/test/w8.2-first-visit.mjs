const base=process.env.BASE_URL||'http://localhost:2000';
(async()=>{const pptr=await import('puppeteer');const b=await pptr.launch({headless:'new'});const pg=await b.newPage();pg.on('console',m=>{const t=m.type();if(t==='error'||t==='warning'){throw new Error('Console '+t+': '+m.text());}});await pg.goto(base+'/',{waitUntil:'networkidle0'});const boot=await pg.$('#guide-boot');if(!boot) throw new Error('Boot CSS missing');const before=await pg.evaluate(()=>({pr:parseFloat(getComputedStyle(document.querySelector('[data-shiftable-root]')).paddingRight),flag:document.documentElement.getAttribute('data-guide-open')}));if(before.flag!==null) throw new Error('data-guide-open should be null initially');if(before.pr>1) throw new Error('Padding-right should be 0 before opening drawer, got '+before.pr);await pg.waitForSelector('[data-testid="sherpa-pill"]',{timeout:8000});await pg.$eval('[data-testid="sherpa-pill"]',(el)=> (el instanceof HTMLElement)&&el.click());await pg.waitForSelector('aside[role="complementary"][data-open="true"]',{timeout:8000});await pg.waitForFunction(()=>document.documentElement.getAttribute('data-guide-open')==='true',{timeout:5000});await new Promise(r=>setTimeout(r,150));const after=await pg.evaluate(()=>({pr:parseFloat(getComputedStyle(document.querySelector('[data-shiftable-root]')).paddingRight),flag:document.documentElement.getAttribute('data-guide-open')}));if(after.flag!=='true') throw new Error('data-guide-open should be true after open');if(after.pr<=1) throw new Error('Padding-right should increase after open');await pg.screenshot({path:'.tmp/mxtk/w8.2-first.png',fullPage:true});await b.close();})().catch(e=>{console.error(e);process.exit(1);});


